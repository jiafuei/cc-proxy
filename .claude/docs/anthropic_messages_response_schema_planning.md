# Anthropic Messages API Response Schema

## Core Response Fields
- **`id`** (string): Unique message identifier (e.g., "msg_013Zva2CMHLNnXjNJJKqJ2EF")
- **`type`** (string): Always "message" for message responses
- **`role`** (string): Always "assistant" for response messages
- **`content`** (array): Array of content blocks generated by the model
- **`model`** (string): The model that handled the request (e.g., "claude-sonnet-4-20250514")
- **`stop_reason`** (string|null): Reason for stopping generation
- **`stop_sequence`** (string|null): Custom stop sequence that triggered stopping (if any)
- **`usage`** (object): Token usage and billing information
- **`container`** (object|null): Container information for code execution tool usage

## Response Content Block Types
Messages contain an array of content blocks with different types:
- **Text blocks**: `{type: "text", text: "...", citations: [...]}`
- **Thinking blocks**: `{type: "thinking", thinking: "...", signature: "..."}`
- **Redacted thinking blocks**: `{type: "redacted_thinking", data: "..."}`
- **Tool use blocks**: `{type: "tool_use", id: "...", name: "...", input: {...}}`
- **Server tool use blocks**: `{type: "server_tool_use", id: "...", name: "...", input: {...}}`
- **Web search tool result blocks**: `{type: "web_search_tool_result", tool_use_id: "...", content: [...]}`
- **Code execution tool result blocks**: `{type: "code_execution_tool_result", tool_use_id: "...", content: {...}}`
- **MCP tool use blocks**: `{type: "mcp_tool_use", id: "...", name: "...", server_name: "...", input: {...}}`
- **MCP tool result blocks**: `{type: "mcp_tool_result", tool_use_id: "...", content: "...", is_error: false}`
- **Container upload blocks**: `{type: "container_upload", file_id: "..."}`

## Stop Reason Values
- **`end_turn`**: Natural stopping point
- **`max_tokens`**: Exceeded token limit
- **`stop_sequence`**: Custom stop sequence encountered
- **`tool_use`**: Model invoked tools
- **`pause_turn`**: Long-running turn paused (can be continued)
- **`refusal`**: Policy violation intervention

## Usage Information
- **`input_tokens`** (integer): Input tokens consumed
- **`output_tokens`** (integer): Output tokens generated
- **`cache_creation_input_tokens`** (integer|null): Tokens used for cache creation
- **`cache_read_input_tokens`** (integer|null): Tokens read from cache
- **`cache_creation`** (object|null): Breakdown of cached tokens by TTL
- **`server_tool_use`** (object|null): Server tool usage statistics
- **`service_tier`** (string|null): Service tier used ("standard", "priority", "batch")

## Citations Support
Text blocks can include citations that reference source documents:
- **Character location citations**: `{type: "char_location", start_char_index: 0, end_char_index: 100, ...}`
- **Page location citations**: `{type: "page_location", start_page_number: 1, end_page_number: 2, ...}`
- **Content block location citations**: `{type: "content_block_location", start_block_index: 0, end_block_index: 1, ...}`
- **Web search result citations**: `{type: "web_search_result_location", url: "...", title: "...", ...}`
- **Search result citations**: `{type: "search_result_location", source: "...", title: "...", ...}`

## Potential Edge Cases
1. **Streaming vs Non-streaming**: Different response formats for streaming and complete responses
2. **Tool Call Chains**: Complex sequences of tool use and results within single response
3. **Thinking Block Handling**: Extended reasoning content that may be redacted or truncated
4. **Citation Complexity**: Multiple citation types with different reference formats
5. **Container State**: Temporary container lifecycle and file management
6. **Cache Token Accounting**: Complex token counting with cache reads/writes
7. **Server Tool Integration**: Mixed client/server tool execution results
8. **MCP Tool Management**: Multi-server tool coordination and result aggregation
9. **Error States**: Tool execution failures and partial response scenarios
10. **Unicode/Encoding**: Special character handling in response content
11. **Response Size Limits**: Large responses and chunking considerations
12. **State Continuity**: Paused turn resumption and context preservation